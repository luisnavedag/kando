<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <title>KanDo</title>
    <link rel="stylesheet" href="{% static 'styles/header.css' %}" />
    <link rel="stylesheet" href="{% static 'styles/side-menu.css' %}" />
    <link rel="stylesheet" href="{% static 'styles/dashboard.css' %}" />
    <link rel="stylesheet" href="{% static 'styles/register.css' %}" />
    <link rel="stylesheet" href="{% static 'styles/toast.css' %}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js" ></script>
    <script>
      
      
      var inputModalContent = ""
      var context = "";
      const NONE = 0;
      const BOARD = 1;
      const ITEM = 2;
      const LIST = 3;

      var creating = NONE;

      /* Set the width of the side navigation to 250px and the left margin of the page content to 250px */
      function openNav() {
        document.getElementById("sidenav").style.width = "250px";
        // document.getElementById("main").style.marginLeft = "250px";
      }
    
      /* Set the width of the side navigation to 0 and the left margin of the page content to 0 */
      function closeNav() {
        document.getElementById("sidenav").style.width = "0";
        // document.getElementById("main").style.marginLeft = "0";
      }
    

      /**
       * Opens modal
       * */
      function openModal(){                          
        $('#modal').modal('show');       
      }

      /**
       * Close modal
       * */
      function closeModal(){
        $('#modal').modal('hide');      
      }

      
      /* GENERIC - reseting the modal and saving the new board */
      function saveModalContent(){
        closeModal();
        document.getElementById("exampleModalLabel").textContent=""
        document.getElementById("modalSmallMessage").textContent=""
        inputModalContent = document.getElementById("modalInput").value;
        document.getElementById("modalInput").value="";

        switch (creating) {
          case BOARD:
            saveNewBoard();
            break;

          case ITEM:
            saveNewItem();
            break;

          case LIST:
          
            break;
        
          default:
            break;
        }

        context = "";
        creating = NONE;
      }


      /* Board */
      function openNewBoarCreation(){
        document.getElementById("exampleModalLabel").textContent="Board Name"             
        document.getElementById("modalSmallMessage").textContent="Name the new board"  
        openModal();   
        creating = BOARD;     
      }


      /* Board */ 
      function saveNewBoard(){
        const newBoardName = inputModalContent // using the content from the modal
        if(""=== newBoardName){
          alert("Can't be empty");
          return          
        }

        /* get container parent */
        const boardParent = document.getElementById("parent-container");


        /* Clone board element */
        const element = document.getElementsByClassName('list-board-container')[0];
        const BoardClone = element.cloneNode(true);

        /* define element title */ 
        BoardClone.getElementsByClassName("title-list-board-container")[0].querySelector("span").textContent = newBoardName
        
        /* define as a sortable */ 
        // Sortable.create(BoardClone.getElementsByClassName("list-items-board")[0], { 
        Sortable.create(BoardClone.getElementsByClassName("list-items-board-child")[0], { 
          animation: 150,
          group: 'shared-items',
          ghostClass: 'hidden-placeholder',          
        });


        BoardClone.style.display = 'block';
        boardParent.append(BoardClone);

      }

      
      /* item */
      function openNewItemCreation(item){
        document.getElementById("exampleModalLabel").textContent="Item Name"             
        document.getElementById("modalSmallMessage").textContent="Name the new Item"
        openModal();
        
        context = item;
        creating = ITEM;
      }

      /* item */
      function saveNewItem(){        
        const newBoardItemName = inputModalContent // using the content from the modal
        
        if(""=== newBoardItemName){
          alert("Can't be empty");
          return          
        }

        /* get item parent */
        const itemParent = context.parentElement.getElementsByClassName("list-items-board-child")[0]         

        /* Clone item element */      
        const element = document.getElementsByClassName('simple-item')[0];
        const itemClone = element.cloneNode(true);

        /* define element title */ 
        itemClone.textContent = newBoardItemName;

        itemParent.append(itemClone);
      
      }
      $('.toast').toast({delay: 600})
    </script>
    
  </head>

  <body>

    <!-- Side bar menu -->
    <!-- <div id="sidenav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <a href="#" onclick="createNewList()">Criar quadro</a>
    </div> -->

    <!-- Modal -->
    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
            <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close" onclick="closeModal()">
              <!-- <span aria-hidden="true">&times;</span> -->
            </button>
          </div>
          <div class="modal-body">
            <small id="modalSmallMessage" class="form-text text-muted">Small message</small>
            <input type="text" class="form-control" id="modalInput" placeholder="Ex: Testing" >
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="closeModal()">Close</button>
            <button type="button" class="btn btn-primary" onclick="saveModalContent()">Save changes</button>
          </div>
        </div>
      </div>
    </div>

 


    <div class="container-fluid">
      {% include 'header.html' %}
    

      {% block content %}

      {% endblock %}
      {% include 'toast.html' %}
    </div>
   
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
    
    <!-- SortableJS for sorting elements as boards and items -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script> 
    
    <!-- references
    https://github.com/SortableJS/Sortable
    https://sortablejs.github.io/Sortable/ 
    -->


    <script >
    
      // var listBoardContainer = document.getElementsByClassName('dashboard-container');  // getting THE list container
      var listBoardContainer = document.getElementsByClassName('dashboard-container')[0].firstElementChild;  // getting THE list container
      const sortContainer = Sortable.create(listBoardContainer, { 
            animation: 150,
            group: 'shared-boards',
            ghostClass: 'hidden-placeholder',
            filter: ".list-board-plus",                                   
          });
          
      
      // var listItemsBoard = document.getElementsByClassName('list-items-board');    // getting the items list container
      var listItemsBoard = document.getElementsByClassName("list-items-board-child");    // getting the items list container - for plus
      
    // defining all items lodaded as draggable 
      for (let index = 0; index < listItemsBoard.length; index++) {
        Sortable.create(listItemsBoard[index], { 
          animation: 150,
          group: 'shared-items',
          ghostClass: 'hidden-placeholder',
          filter: ".plus-item-board",
          
        });
        
      }
      
      
    </script>
  </body>
</html>